{
  "path": "IO-Filter-Rendering\\isosurface\\deepwater\\description.txt",
  "name": "description.txt",
  "prompt": "Generate an HTML page using vtk.js to visualize the Deepwater dataset with isosurface rendering.\n\nLoad the dataset from: http://127.0.0.1:5000/dataset/deepwater.vti\n\nCompute velocity magnitude from arrays v02 and v03\n\nGenerate an isosurface at the mid-value of the scalar range\n\nUse a blue → white → red color map spanning the scalar range (min to max)\n\nSet the isosurface to fully opaque with smooth shading\n\nAdd an XYZ orientation marker in the bottom-right corne",
  "ground_truth": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Deepwater数据集等值面渲染</title>\n    <style>\n        body,\n        html {\n            margin: 0;\n            padding: 0;\n            width: 100%;\n            height: 100%;\n            overflow: hidden;\n        }\n\n        #renderer {\n            width: 100%;\n            height: 100%;\n        }\n    </style>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const vtkActor = vtk.Rendering.Core.vtkActor;\n        const vtkMapper = vtk.Rendering.Core.vtkMapper;\n        const vtkXMLImageDataReader = vtk.IO.XML.vtkXMLImageDataReader;\n        const vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;\n        const vtkImageMarchingCubes = vtk.Filters.General.vtkImageMarchingCubes;\n\n        const fullScreenRenderWindow = vtkFullScreenRenderWindow.newInstance({\n            background: [1,1,1],\n        });\n        const renderWindow = fullScreenRenderWindow.getRenderWindow();\n        const renderer = fullScreenRenderWindow.getRenderer();\n\n        const reader = vtkXMLImageDataReader.newInstance();\n        reader.setUrl('http://127.0.0.1:5000/dataset/deepwater.vti').then(() => {\n            reader.loadData().then(() => {\n                const imageData = reader.getOutputData(0);\n\n                // 输出数据集中的数组名称，帮助调试\n                // 修复：getArrayNames不是一个函数，改用getArrays()获取数组列表\n                const arrays = imageData.getPointData().getArrays();\n                const arrayNames = arrays.map(array => array.getName());\n                console.log('数据集中的数组:', arrayNames);\n\n                // 使用v02和v03数组计算速度大小\n                const v02Array = imageData.getPointData().getArrayByName('v02');\n                const v03Array = imageData.getPointData().getArrayByName('v03');\n                \n                if (!v02Array || !v03Array) {\n                    console.error('找不到v02或v03数组');\n                    // 尝试使用其他可用数组\n                    const availableArray = imageData.getPointData().getArrayByName('prs');\n                    if (availableArray) {\n                        // 直接使用压力(prs)数组作为标量场\n                        imageData.getPointData().setActiveScalars('prs');\n                    } else {\n                        console.error('无法找到合适的数组进行渲染');\n                        return;\n                    }\n                } else {\n                    // 计算速度大小\n                    const numPoints = imageData.getNumberOfPoints();\n                    const magnitudeData = new Float64Array(numPoints);\n\n                    for (let i = 0; i < numPoints; i++) {\n                        // v02和v03是标量数组，直接获取值\n                        const v2 = v02Array.getData()[i];\n                        const v3 = v03Array.getData()[i];\n                        // 计算速度大小\n                        magnitudeData[i] = Math.sqrt(v2 * v2 + v3 * v3);\n                    }\n\n                    // 创建速度大小数组\n                    const vtkDataArray = vtk.Common.Core.vtkDataArray;\n                    const magnitudeVtkArray = vtkDataArray.newInstance({\n                        numberOfComponents: 1,\n                        values: magnitudeData,\n                        name: 'velocityMagnitude',\n                    });\n                    imageData.getPointData().addArray(magnitudeVtkArray);\n                    imageData.getPointData().setActiveScalars('velocityMagnitude');\n                }\n\n                // 获取当前活动标量的范围\n                const activeScalars = imageData.getPointData().getScalars();\n                const newRange = activeScalars.getRange();\n                const [minV, maxV] = newRange;\n\n                console.log('使用的标量字段:', activeScalars.getName());\n                console.log('数据范围:', newRange);\n\n                const marchingCube = vtkImageMarchingCubes.newInstance({\n                    contourValue: minV + 0.5 * (maxV - minV),\n                    computeNormals: true,\n                    mergePoints: true\n                });\n\n                marchingCube.setInputData(imageData);\n\n                const mapper = vtkMapper.newInstance();\n                mapper.setInputConnection(marchingCube.getOutputPort());\n\n                const colorTransferFunction = vtkColorTransferFunction.newInstance();\n                colorTransferFunction.addRGBPoint(minV, 0.0, 0.0, 1.0);\n                colorTransferFunction.addRGBPoint(minV + 0.25 * (maxV - minV), 0.0, 0.5, 1.0);\n                colorTransferFunction.addRGBPoint(minV + 0.5 * (maxV - minV), 1.0, 1.0, 1.0);\n                colorTransferFunction.addRGBPoint(minV + 0.75 * (maxV - minV), 1.0, 0.5, 0.0);\n                colorTransferFunction.addRGBPoint(maxV, 1.0, 0.0, 0.0);\n\n                mapper.setLookupTable(colorTransferFunction);\n                mapper.setScalarRange(minV, maxV);\n                mapper.setInterpolateScalarsBeforeMapping(true);\n\n                const actor = vtkActor.newInstance();\n                actor.setMapper(mapper);\n                actor.getProperty().setRepresentationToSurface();\n                actor.getProperty().setEdgeVisibility(false);\n                actor.getProperty().setOpacity(1.0);\n                actor.getProperty().setAmbient(0.3);\n                actor.getProperty().setDiffuse(0.7);\n                actor.getProperty().setSpecular(0.4);\n\n                renderer.addActor(actor);\n\n                const bounds = imageData.getBounds();\n                const center = [\n                    (bounds[0] + bounds[1]) / 2,\n                    (bounds[2] + bounds[3]) / 2,\n                    (bounds[4] + bounds[5]) / 2,\n                ];\n\n                const camera = renderer.getActiveCamera();\n                camera.setFocalPoint(...center);\n                camera.setPosition(center[0] + 300, center[1] + 200, center[2] + 200);\n                camera.setViewUp(0, 0, 1);\n                renderer.resetCameraClippingRange();\n                renderWindow.render();\n                renderer.resetCamera();\n                renderWindow.render();\n\n                const axes = vtk.Rendering.Core.vtkAxesActor.newInstance();\n                const widget = vtk.Interaction.Widgets.vtkOrientationMarkerWidget.newInstance({\n                    actor: axes,\n                    interactor: renderWindow.getInteractor(),\n                });\n                widget.setEnabled(true);\n                widget.setViewportCorner(\n                    vtk.Interaction.Widgets.vtkOrientationMarkerWidget.Corners.BOTTOM_RIGHT\n                );\n                widget.setViewportSize(0.15);\n                widget.setMinPixelSize(100);\n                widget.setMaxPixelSize(300);\n\n                const interactor = renderWindow.getInteractor();\n                interactor.start();\n            });\n        });\n    </script>\n</body>\n\n</html>",
  "generated_code": "```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Deepwater Dataset Isosurface Visualization</title>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        // Create full screen render window with black background\n        const fullScreenRenderer = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n\n        // Create HTTP data reader to load VTI file\n        const reader = vtk.IO.Core.vtkHttpDataSetReader.newInstance({ fetchGzip: false });\n\n        // Create calculator to compute velocity magnitude from v02 and v03 arrays\n        const calculator = vtk.Filters.General.vtkCalculator.newInstance();\n        calculator.setFormula({\n            getArrays: (inputDataSets) => ({\n                input: [\n                    { location: 'PointData', name: 'v02' },\n                    { location: 'PointData', name: 'v03' }\n                ],\n                output: [\n                    { location: 'PointData', name: 'Velocity Magnitude' }\n                ]\n            }),\n            evaluate: (arraysIn, arraysOut) => {\n                const [v02, v03] = arraysIn;\n                const velMag = arraysOut[0];\n                // Compute velocity magnitude as sqrt(v02^2 + v03^2)\n                for (let i = 0; i < v02.length; i++) {\n                    velMag[i] = Math.sqrt(v02[i] * v02[i] + v03[i] * v03[i]);\n                }\n            }\n        });\n\n        // Create contour filter for isosurface generation\n        const contourFilter = vtk.Filters.Core.vtkContourFilter.newInstance();\n        \n        // Create mapper and actor for isosurface\n        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();\n        const actor = vtk.Rendering.Core.vtkActor.newInstance();\n\n        // Set up the pipeline: reader -> calculator -> contour -> mapper -> actor\n        calculator.setInputConnection(reader.getOutputPort());\n        contourFilter.setInputConnection(calculator.getOutputPort());\n        mapper.setInputConnection(contourFilter.getOutputPort());\n        actor.setMapper(mapper);\n\n        // Configure actor properties for smooth shading and full opacity\n        const property = actor.getProperty();\n        property.setInterpolationToGouraud(); // Smooth shading\n        property.setOpacity(1.0); // Fully opaque\n\n        // Load the deepwater dataset\n        reader.setUrl('http://127.0.0.1:5000/dataset/deepwater.vti', { loadData: true }).then(() => {\n            // After data is loaded, set up the visualization\n            const data = calculator.getOutputData();\n            const velocityArray = data.getPointData().getArray('Velocity Magnitude');\n            \n            if (velocityArray) {\n                const range = velocityArray.getRange();\n                const minVal = range[0];\n                const maxVal = range[1];\n                const midVal = (minVal + maxVal) / 2.0;\n\n                // Set contour value to mid-range\n                contourFilter.setContourValue(0, midVal);\n\n                // Create blue -> white -> red color transfer function\n                const colorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction.newInstance();\n                colorTransferFunction.addRGBPoint(minVal, 0.0, 0.0, 1.0); // Blue at minimum\n                colorTransferFunction.addRGBPoint(midVal, 1.0, 1.0, 1.0); // White at middle\n                colorTransferFunction.addRGBPoint(maxVal, 1.0, 0.0, 0.0); // Red at maximum\n\n                // Apply color map to mapper\n                mapper.setLookupTable(colorTransferFunction);\n                mapper.setScalarRange(minVal, maxVal);\n                mapper.setScalarModeToUsePointFieldData();\n                mapper.setColorModeToMapScalars();\n                mapper.setArrayAccessMode(1); // Use array name\n                mapper.setColorByArrayName('Velocity Magnitude');\n            }\n\n            // Add actor to renderer\n            renderer.addActor(actor);\n\n            // Create orientation marker (XYZ axes) in bottom-right corner\n            const axes = vtk.Rendering.Core.vtkAxesActor.newInstance();\n            const orientationMarker = vtk.Interaction.Widgets.vtkOrientationMarkerWidget.newInstance({\n                actor: axes,\n                interactor: renderWindow.getInteractor()\n            });\n            orientationMarker.setEnabled(true);\n            orientationMarker.setViewport({ xmin: 0.8, xmax: 1.0, ymin: 0.0, ymax: 0.2 }); // Bottom-right corner\n\n            // Reset camera and render\n            renderer.resetCamera();\n            renderWindow.render();\n        }).catch((error) => {\n            console.error('Error loading dataset:', error);\n        });\n\n        // Expose objects to global scope for debugging\n        window.reader = reader;\n        window.calculator = calculator;\n        window.contourFilter = contourFilter;\n        window.mapper = mapper;\n        window.actor = actor;\n        window.renderer = renderer;\n        window.renderWindow = renderWindow;\n\n    </script>\n\n</body>\n\n</html>\n```",
  "generator_prompt": "Please use vtkjs to generate visualization code. The code should be in the form of a complete code wrapped only in HTML tags. Please add your thinking process as comments in the code to make it easier to understand the code logic.\n\nIn the code, use `<script src=\"https://unpkg.com/vtk.js\"></script>` as the library for visualization to implement the visualization function.\nPlease follow the following rules:\n1. The content of the answer is HTML code with vtkjs script(start from <!DOCTYPE html>), and if there is any explanation, it should be given in the form of comments.\n2. If the sample code is relevant to the user's requirements, implement the user's requirements based on the sample code.\n3. The answer should be based on the provided sample information, and do not fabricate functions that do not exist. \nPlease implement the code strictly according to the specific requirements of the user in the `<QUESTION></QUESTION>` tag. Ensure that the code logic is clear and straightforward, and generate the visualization-related code completely in accordance with the syntax specifications of vtkjs. \n<QUESTION>__QUESTION__</QUESTION>\n\n",
  "final_prompt": "\n    Generate only the HTML code without any additional text or markdown formatting.\n    User Requirements:\n    Generate an HTML page using vtk.js to visualize the Deepwater dataset with isosurface rendering.\n\nLoad the dataset from: http://127.0.0.1:5000/dataset/deepwater.vti\n\nCompute velocity magnitude from arrays v02 and v03\n\nGenerate an isosurface at the mid-value of the scalar range\n\nUse a blue → white → red color map spanning the scalar range (min to max)\n\nSet the isosurface to fully opaque with smooth shading\n\nAdd an XYZ orientation marker in the bottom-right corne\n\n    Relevant VTK.js Examples:\n    示例 1:\n描述: Loads 3D volume data, writes it to a binary XML format using `vtkXMLImageDataWriter`, reads it back with `vtkXMLImageDataReader`, and visualizes it\nVTK.js 模块: ['vtk.IO.XML.vtkXMLImageDataWriter.newInstance', 'vtk.Common.DataModel.vtkPiecewiseFunction.newInstance', 'vtk.IO.Core.vtkHttpDataSetReader.newInstance', 'vtk.IO.XML.vtkXMLImageDataReader.newInstance', 'vtk.IO.XML.vtkXMLWriter.FormatTypes.BINARY', 'vtk.Rendering.Core.vtkColorTransferFunction.newInstance', 'vtk.Rendering.Core.vtkVolume.newInstance', 'vtk.Rendering.Core.vtkVolumeMapper.newInstance', 'vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance']\n代码:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js XMLImageDataWriter</title>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n\n    <script type=\"text/javascript\" src=\"https://unpkg.com/@babel/polyfill@7.0.0/dist/polyfill.js\"></script>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n\n        // ----------------------------------------------------------------------------\n        // Standard rendering code setup\n        // ----------------------------------------------------------------------------\n\n        const dataPath = 'http://kitware.github.io/vtk-js/data/volume/headsq.vti';\n        const fullScreenRenderer = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance();\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n\n        const reader = vtk.IO.Core.vtkHttpDataSetReader.newInstance({ fetchGzip: true });\n\n        const writer = vtk.IO.XML.vtkXMLImageDataWriter.newInstance();\n        writer.setFormat(vtk.IO.XML.vtkXMLWriter.FormatTypes.BINARY);\n        writer.setInputConnection(reader.getOutputPort());\n\n        const writerReader = vtk.IO.XML.vtkXMLImageDataReader.newInstance();\n\n        reader\n            .setUrl(dataPath, { loadData: true })\n            .then(() => {\n                const fileContents = writer.write(reader.getOutputData());\n\n                // Try to read it back.\n                const textEncoder = new TextEncoder();\n                writerReader.parseAsArrayBuffer(textEncoder.encode(fileContents));\n                renderer.resetCamera();\n                renderWindow.render();\n\n                const blob = new Blob([fileContents], { type: 'text/plain' });\n                const a = window.document.createElement('a');\n                a.href = window.URL.createObjectURL(blob, { type: 'text/plain' });\n                a.download = 'headsq.vti';\n                a.text = 'Download';\n                a.style.position = 'absolute';\n                a.style.left = '50%';\n                a.style.bottom = '10px';\n                document.body.appendChild(a);\n                a.style.background = 'white';\n                a.style.padding = '5px';\n            });\n\n        const actor = vtk.Rendering.Core.vtkVolume.newInstance();\n        const mapper = vtk.Rendering.Core.vtkVolumeMapper.newInstance();\n        mapper.setSampleDistance(1.1);\n        actor.setMapper(mapper);\n\n        mapper.setInputConnection(writerReader.getOutputPort());\n\n        // create color and opacity transfer functions\n        const ctfun = vtk.Rendering.Core.vtkColorTransferFunction.newInstance();\n        ctfun.addRGBPoint(200.0, 1.0, 1.0, 1.0);\n        ctfun.addRGBPoint(2000.0, 0.0, 0.0, 0.0);\n        const ofun = vtk.Common.DataModel.vtkPiecewiseFunction.newInstance();\n        ofun.addPoint(200.0, 0.0);\n        ofun.addPoint(1200.0, 0.2);\n        ofun.addPoint(4000.0, 0.4);\n        actor.getProperty().setRGBTransferFunction(0, ctfun);\n        actor.getProperty().setScalarOpacity(0, ofun);\n        actor.getProperty().setScalarOpacityUnitDistance(0, 4.5);\n        // actor.getProperty().setInterpolationTypeToNearest();\n        // actor.getProperty().setInterpolationTypeToFastLinear();\n        actor.getProperty().setInterpolationTypeToLinear();\n\n        renderer.addActor(actor);\n\n        window.writer = writer;\n        window.writerReader = writerReader;\n        window.mapper = mapper;\n        window.actor = actor;\n        window.renderer = renderer;\n        window.renderWindow = renderWindow;\n\n    </script>\n\n</body>\n\n</html>\n\n--------------------------------------------------------------------------------------------------------------\n示例 2:\n描述: Loads 3D polydata, writes it to a string using `vtkXMLPolyDataWriter`, reads it back with `vtkXMLPolyDataReader`, and renders it, allowing download of the generated VTP file.\nVTK.js 模块: ['vtk.IO.Core.vtkHttpDataSetReader', 'vtk.IO.XML.vtkXMLPolyDataReader', 'vtk.IO.XML.vtkXMLPolyDataWriter', 'vtk.IO.XML.vtkXMLWriter', 'vtk.Rendering.Core.vtkActor.newInstance', 'vtk.Rendering.Core.vtkMapper.newInstance', 'vtk.Rendering.Misc.vtkFullScreenRenderWindow']\n代码:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js XMLImagePolyDataWriter</title>\n    <!-- <link rel=\"stylesheet\" href=\"https://kit.fontawesome.com/419a5ebb56.css\" crossorigin=\"anonymous\"> -->\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n\n    <script type=\"text/javascript\" src=\"https://unpkg.com/@babel/polyfill@7.0.0/dist/polyfill.js\"></script>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();\n        const actor = vtk.Rendering.Core.vtkActor.newInstance();\n        const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const httpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;\n        const xmlPolyDataWriter = vtk.IO.XML.vtkXMLPolyDataWriter;\n        const xmlPolyDataReader = vtk.IO.XML.vtkXMLPolyDataReader;\n        const xmlWriter = vtk.IO.XML.vtkXMLWriter;\n        // Create instances using namespace paths\n        const fullScreenRenderer = fullScreenRenderWindow.newInstance();\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n        const reader = httpDataSetReader.newInstance({ fetchGzip: true });\n\n        const writer = xmlPolyDataWriter.newInstance();\n        writer.setFormat(xmlWriter.FormatTypes.BINARY);\n        writer.setInputConnection(reader.getOutputPort());\n\n        const writerReader = xmlPolyDataReader.newInstance();\n\n        reader.setUrl(`http://kitware.github.io/vtk-js/data/cow.vtp`, { loadData: true }).then(() => {\n            const fileContents = writer.write(reader.getOutputData());\n\n            // Try to read it back.\n            const textEncoder = new TextEncoder();\n            writerReader.parseAsArrayBuffer(textEncoder.encode(fileContents));\n            renderer.resetCamera();\n            renderWindow.render();\n\n            const blob = new Blob([fileContents], { type: 'text/plain' });\n            const a = window.document.createElement('a');\n            a.href = window.URL.createObjectURL(blob, { type: 'text/plain' });\n            a.download = 'cow.vtp';\n            a.text = 'Download';\n            a.style.position = 'absolute';\n            a.style.left = '50%';\n            a.style.bottom = '10px';\n            document.body.appendChild(a);\n            a.style.background = 'white';\n            a.style.padding = '5px';\n        });\n\n        actor.setMapper(mapper);\n\n        mapper.setInputConnection(writerReader.getOutputPort());\n\n        renderer.addActor(actor);\n\n        window.writer = writer;\n        window.writerReader = writerReader;\n        window.mapper = mapper;\n        window.actor = actor;\n        window.renderer = renderer;\n        window.renderWindow = renderWindow;\n\n\n    </script>\n\n</body>\n\n</html>\n\n--------------------------------------------------------------------------------------------------------------\n示例 3:\n描述: Loads and visualizes 3D elevation data from a CSV, applying a texture image, using `vtkElevationReader` and `vtkMapper`.\n\nVTK.js 模块: ['vtk.IO.Misc.vtkElevationReader.newInstance', 'vtk.Rendering.Core.vtkActor.newInstance', 'vtk.Rendering.Core.vtkMapper.newInstance', 'vtk.Rendering.Core.vtkTexture.newInstance', 'vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance']\n代码:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js ElevationReader</title>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n\n    <script type=\"text/javascript\" src=\"https://unpkg.com/@babel/polyfill@7.0.0/dist/polyfill.js\"></script>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n\n\n        const imagePath = 'http://kitware.github.io/vtk-js/data/elevation/dem.jpg';\n        // const imagePath = './dem.jpg'\n        const dataPath = 'http://kitware.github.io/vtk-js/data/elevation/dem.csv';\n        const fullScreenRenderer = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n        const reader = vtk.IO.Misc.vtkElevationReader.newInstance({\n            xSpacing: 0.01568,\n            ySpacing: 0.01568,\n            zScaling: 0.06666,\n        });\n        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();\n        const actor = vtk.Rendering.Core.vtkActor.newInstance();\n\n        mapper.setInputConnection(reader.getOutputPort());\n        actor.setMapper(mapper);\n\n        renderer.addActor(actor);\n        renderer.resetCamera();\n        renderWindow.render();\n\n        // Download and apply Texture\n        const img = new Image();\n        img.src = imagePath;\n        //Add crossorigin=\"anonymous\" to avoid CORS errors\n        img.crossOrigin = \"anonymous\"\n        img.onload = function textureLoaded() {\n            const texture = vtk.Rendering.Core.vtkTexture.newInstance();\n            texture.setInterpolate(true);\n            texture.setImage(img);\n            actor.addTexture(texture);\n            renderWindow.render();\n        };\n\n        // Download elevation and render when ready\n        reader.setUrl(dataPath).then(() => {\n            renderer.resetCamera();\n            renderWindow.render();\n        });\n\n        window.reader = reader;\n        window.mapper = mapper;\n        window.actor = actor;\n        window.renderer = renderer;\n        window.renderWindow = renderWindow;\n\n    </script>\n\n</body>\n\n</html>\n\n--------------------------------------------------------------------------------------------------------------\n示例 4:\n描述: Loads and visualizes a 3D polygonal data file (`test_cone.vtp`) using `vtkXMLPolyDataReader` and `vtkMapper`.\n\nVTK.js 模块: ['vtk.IO.XML.vtkXMLPolyDataReader', 'vtk.Rendering.Core.vtkActor', 'vtk.Rendering.Core.vtkMapper', 'vtk.Rendering.Misc.vtkFullScreenRenderWindow']\n代码:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js loading poly data, need to start by live server</title>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const vtkXMLPolyDataReader = vtk.IO.XML.vtkXMLPolyDataReader;\n        const vtkActor = vtk.Rendering.Core.vtkActor;\n        const vtkMapper = vtk.Rendering.Core.vtkMapper;\n\n        // crete the render window\n        const fullScreenRenderer = vtkFullScreenRenderWindow.newInstance({ background: [0, 0, 0] });\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n\n        // load the vtp data locally\n        const reader = vtkXMLPolyDataReader.newInstance();\n        // set url and load the data\n        reader.setUrl('../datasets/test_cone.vtp').then(() => {\n            reader.loadData().then(() => {\n                // assign data to actor\n                const mapper = vtkMapper.newInstance();\n                console.log(reader.getOutputData(0))\n                mapper.setInputData(reader.getOutputData(0));\n                const actor = vtkActor.newInstance();\n                actor.setMapper(mapper);\n\n                //  adding actor to render and render the data\n                renderer.addActor(actor);\n                renderer.resetCamera();\n                renderWindow.render();\n            });\n        });\n    </script>\n</body>\n\n</html>\n\n\n            ",
  "evaluator_prompt": "# Role\n\nYou are an expert Evaluator for vtk.js and web-based scientific visualization. Your task is to compare the [GENERATED_CODE] against the [GROUND_TRUTH] and evaluate it based on specific dimensions.\n\n# Input Data\n\n## Ground Truth Code:\n\n[GROUND_TRUTH]\n\n## Generated Code:\n\n[GENERATED_CODE]\n\n# Evaluation Criteria & Rubric (0.0 to 1.0)\n\nPlease evaluate the generated code based on the following 3 dimensions. \n\n1. **Functionality & Completeness (Task Completion)**: \n   - Does the code implement the same visualization pipeline as the ground truth? (e.g., correct readers, mappers, filters).\n   - Are critical elements present (e.g., color transfer functions, full-screen rendering)?\n   - Score 1.0 if logic is identical; lower if steps are missing.\n\n2. **Visual Fidelity (Visual Quality)**:\n   - Based on the code logic, will the visual output look similar to the ground truth?\n   - Check camera parameters, background colors, and opacity transfer functions.\n   - Check if the correct data arrays (scalars/vectors) are selected for coloring.\n\n3. **Code Quality & Maintainability**:\n   - Is the code readable, well-structured, and using vtk.js best practices?\n   - Is the variable naming clear?\n\n# Response Format\n\nYou must output the evaluation in the following Strict XML format. Do not use Markdown block quotes.\n\n<Evaluation>\n    <Dimension name=\"Functionality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Dimension name=\"VisualQuality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Dimension name=\"CodeQuality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Summary>\n        <OverallScore>[AVERAGE_SCORE]</OverallScore>\n        <Critique>[ONE_SENTENCE_SUMMARY]</Critique>\n    </Summary>\n</Evaluation>",
  "generator": "claude-sonnet-4",
  "evaluator": "deepseek-v3",
  "score": "0.85",
  "workflow": {
    "inquiryExpansion": true,
    "rag": true
  },
  "eval_id": "1764330129",
  "eval_user": "test",
  "export_time": null,
  "console_output": null,
  "eval_time": "2025-11-28 19:42:09",
  "evaluator_evaluation": "<Evaluation>\n    <Dimension name=\"Functionality\">\n        <Score>0.8</Score>\n        <Reason>The generated code implements the same visualization pipeline and correctly computes velocity magnitude, but uses a different contour filter (vtkContourFilter vs vtkImageMarchingCubes) and a different reader (`vtkHttpDataSetReader` vs `vtkXMLImageDataReader`). It also lacks the detailed property settings for ambient, diffuse, and specular lighting.</Reason>\n    </Dimension>\n    <Dimension name=\"VisualQuality\">\n        <Score>0.85</Score>\n        <Reason>The visual output should look very similar, using the same color transfer function and slices. However, the background color and exact positioning/sizing of the orientation widget differ slightly.</Reason>\n    </Dimension>\n    <Dimension name=\"CodeQuality\">\n        <Score>0.9</Score>\n        <Reason>The code is well-structured and readable, using proper vtk.js patterns. The use of a calculator to compute velocity magnitude is particularly elegant. Some variable names could be more descriptive.</Reason>\n    </Dimension>\n    <Summary>\n        <OverallScore>0.85</OverallScore>\n        <Critique>The generated code produces a functionally equivalent visualization with minor implementation differences, maintaining good code quality.</Critique>\n    </Summary>\n</Evaluation>",
  "options": null,
  "analysis": "Data Loading — Load the dataset from 'http://127.0.0.1:5000/dataset/deepwater.vti' using vtkXMLImageDataWriter.\nData Processing — Compute velocity magnitude from arrays 'v02' and 'v03' using vtkCalculator with a formula like 'sqrt(v02^2 + v03^2)' to create a new scalar field.\nIsosurface Generation — Generate an isosurface at the mid-value of the scalar range using vtkImageMarchingCubes with the computed scalar field.\nColor Mapping — Apply a blue → white → red color map spanning the scalar range (min to max) using vtkColorTransferFunction and assign it to the mapper.\nSurface Properties — Set the isosurface to fully opaque with smooth shading by configuring the mapper's properties for opacity (1.0) and lighting (smooth shading).\nUI Components — Add an XYZ orientation marker in the bottom-right corner using vtkOutlineFilter and vtkActor to provide spatial reference.\nRendering — Configure the render window, renderer, and interactor to display the visualization without any GUI controls.",
  "retrieval_results": [
    {
      "id": 299933080,
      "title": "Example 1",
      "description": "Loads 3D volume data, writes it to a binary XML format using `vtkXMLImageDataWriter`, reads it back with `vtkXMLImageDataReader`, and visualizes it",
      "relevance": 0.8582473993301392
    },
    {
      "id": 144437569,
      "title": "Example 2",
      "description": "Loads 3D polydata, writes it to a string using `vtkXMLPolyDataWriter`, reads it back with `vtkXMLPolyDataReader`, and renders it, allowing download of the generated VTP file.",
      "relevance": 0.5654895305633545
    },
    {
      "id": 2054430029,
      "title": "Example 3",
      "description": "Loads and visualizes 3D elevation data from a CSV, applying a texture image, using `vtkElevationReader` and `vtkMapper`.\n",
      "relevance": 0.5048385858535767
    },
    {
      "id": 777604084,
      "title": "Example 4",
      "description": "Loads and visualizes a 3D polygonal data file (`test_cone.vtp`) using `vtkXMLPolyDataReader` and `vtkMapper`.\n",
      "relevance": 0.47593748569488525
    }
  ]
}