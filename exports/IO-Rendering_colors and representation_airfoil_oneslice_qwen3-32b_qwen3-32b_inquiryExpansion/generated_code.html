<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VTK.js Volume Rendering Example</title>
  <!-- 引入 VTK.js 的核心库 -->
  <script src="https://unpkg.com/vtk.js"></script>
  <style>
    /* 设置渲染窗口为全屏显示 */
    body, html {
      margin: 0;
      height: 100%;
    }
    #container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="container"></div>

  <script>
    // 使用vtk模块加载器来异步导入所需组件
    const vtk = window.vtk;

    (async () => {
      // 1. 创建数据集读取器，用于从指定URL加载VTP文件
      const reader = vtk.io.http.HttpDataSetReader.newInstance();
      reader.setUrl("https://example.com/path/to/airfoil_oneslice.vtp"); // 替换为实际的VTP文件地址

      // 2. 等待数据加载完成
      await reader.loadData();

      // 3. 创建Mapper对象，将数据集映射为图形表示
      const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
      mapper.setInputConnection(reader.getOutputPort());

      // 4. 创建Actor对象，用于定义如何在场景中渲染数据
      const actor = vtk.Rendering.Core.vtkActor.newInstance();
      actor.setMapper(mapper);

      // 5. 创建颜色映射（Color Map）并将其应用于Mapper
      // 这里使用简单的线性映射（可以根据需求自定义）
      const colorTransferFunction = vtk.Common.DataModel.vtkColorTransferFunction.newInstance();
      colorTransferFunction.addRGBPoint(0.0, 0.0, 0.0, 1.0);   // 黑色
      colorTransferFunction.addRGBPoint(1.0, 1.0, 0.0, 0.0);   // 红色
      mapper.setColorMap(colorTransferFunction);

      // 6. 创建Renderer对象，用于管理渲染场景
      const renderer = vtk.Rendering.Core.vtkRenderer.newInstance();

      // 将Actor添加到渲染器中
      renderer.addActor(actor);

      // 设置背景颜色
      renderer.setBackground(0.1, 0.2, 0.4);

      // 7. 创建RenderWindow对象，并设置容器
      const renderWindow = vtk.Rendering.Core.vtkRenderWindow.newInstance();
      renderWindow.addRenderer(renderer);
      const widget = document.getElementById('container');
      renderWindow.setContainer(widget);

      // 8. 初始化渲染并自动调整相机视角以聚焦于数据边界
      renderWindow.render(); // 初次渲染

      // 自动调整相机位置以聚焦于数据集边界
      renderer.resetCamera();
      renderWindow.render(); // 再次渲染以应用相机调整
    })();
  </script>
</body>
</html>
