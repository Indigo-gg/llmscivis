<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTK.js Airfoil Rendering with Surface LIC</title>
    <script src="https://unpkg.com/vtk.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #renderer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="renderer"></div>
    <script>
        // Import required VTK.js classes
        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;
        const vtkActor = vtk.Rendering.Core.vtkActor;
        const vtkMapper = vtk.Rendering.Core.vtkMapper;
        const vtkXMLPolyDataReader = vtk.IO.XML.vtkXMLPolyDataReader;
        const vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;
        const vtkLookupTable = vtk.Common.Core.vtkLookupTable;
        // Removed non-existent SurfaceLICMapper reference
        // const vtkSurfaceLICMapper = vtk.Rendering.Core.vtkSurfaceLICMapper;

        // Initialize rendering window
        const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({
            background: [0.1, 0.1, 0.1],
        });
        const renderWindow = fullScreenRenderWindow.getRenderWindow();
        const renderer = fullScreenRenderWindow.getRenderer();

        // Create PolyData reader
        const reader = vtkXMLPolyDataReader.newInstance();

        // Set URL and load data
        reader.setUrl('http://127.0.0.1:5000/dataset/airfoil_oneslice.vtp').then(() => {
            reader.loadData().then(() => {
                // Get loaded polygon data
                const polyData = reader.getOutputData(0);

                // Get scalar arrays from data
                const pointData = polyData.getPointData();
                const arrays = pointData.getArrays();
                const scalarNames = [];
                arrays.forEach((array, name) => {
                    scalarNames.push(name);
                });
                console.log('Available scalars:', scalarNames);

                // Select p as color scalar
                polyData.getPointData().setActiveScalars('p');
                // Get scalar range
                const dataRange = polyData.getPointData().getScalars().getRange();
                console.log('Data range:', dataRange);

                const mapper = vtkMapper.newInstance();
                mapper.setInputData(polyData);

                // Create actor
                const actor = vtkActor.newInstance();
                actor.setMapper(mapper);
                // Add actor to renderer
                renderer.addActor(actor);

                // Calculate data bounds and center point
                const bounds = polyData.getBounds();
                const center = [
                    (bounds[0] + bounds[1]) / 2, // X center
                    (bounds[2] + bounds[3]) / 2, // Y center
                    (bounds[4] + bounds[5]) / 2, // Z center
                ];

                // Configure camera view - adjusted based on image
                const camera = renderer.getActiveCamera();
                camera.setFocalPoint(...center);
                camera.setPosition(center[0], center[1], center[2] + 5);
                camera.setViewUp(0, 1, 0);

                // Reset camera and clipping range
                renderer.resetCamera();
                renderer.resetCameraClippingRange();

                // Render scene
                renderWindow.render();

                // Add axis indicator
                const axes = vtk.Rendering.Core.vtkAxesActor.newInstance();
                const widget = vtk.Interaction.Widgets.vtkOrientationMarkerWidget.newInstance({
                    actor: axes,
                    interactor: renderWindow.getInteractor(),
                });
                widget.setEnabled(true);
                widget.setViewportCorner(
                    vtk.Interaction.Widgets.vtkOrientationMarkerWidget.Corners.BOTTOM_RIGHT
                );
                widget.setViewportSize(0.15);
                widget.setMinPixelSize(100);
                widget.setMaxPixelSize(300);
            });
        }).catch(error => {
            console.error('Error loading dataset:', error);
        });
    </script>
</body>

</html>