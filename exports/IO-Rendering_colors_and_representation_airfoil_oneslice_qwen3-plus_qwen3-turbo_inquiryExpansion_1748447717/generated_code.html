<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VTK.js Volume Rendering of Airfoil Dataset</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <!-- Container for the renderer -->
  <div id="renderer"></div>

  <!-- Load vtk.js from CDN -->
  <script src="https://unpkg.com/vtk.js"></script>

  <script>
    // Import required VTK.js modules
    const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;
    const vtkHttpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;
    const vtkVolume = vtk.Rendering.Core.vtkVolume;
    const vtkVolumeMapper = vtk.Rendering.Core.vtkVolumeMapper;
    const vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;
    const vtkPiecewiseFunction = vtk.Common.DataModel.vtkPiecewiseFunction;
    const vtkCamera = vtk.Rendering.Core.vtkCamera;

    // Initialize full-screen render window and renderer
    const fullScreenRenderer = vtkFullScreenRenderWindow.newInstance({
      background: [0, 0, 0], // black background
      rootContainer: document.body,
      containerStyle: { height: '100%' },
    });
    const renderer = fullScreenRenderer.getRenderer();
    const renderWindow = fullScreenRenderer.getRenderWindow();

    // Create a volume mapper and actor for volume rendering
    const volumeMapper = vtkVolumeMapper.newInstance();
    const volumeActor = vtkVolume.newInstance();

    // Set up the dataset reader to load the remote VTP file
    const reader = vtkHttpDataSetReader.newInstance({ fetchGzip: false });
    reader.setUrl('http://127.0.0.1:5000/dataset/airfoil_oneslice.vtp').then(() => {
      reader.update(); // Trigger data loading

      const dataset = reader.getOutputData(0); // Get the loaded dataset

      // Activate the scalar array named "p" for color mapping
      dataset
        .getPointData()
        .setActiveScalars('p'); // Make sure 'p' is the exact name in your VTP file

      // Assign the dataset to the mapper
      volumeMapper.setInputData(dataset);

      // Configure the volume actor with the mapper
      volumeActor.setMapper(volumeMapper);

      // Add the volume actor to the scene
      renderer.addVolume(volumeActor);

      // Create and configure the color transfer function (CTF)
      const ctf = vtkColorTransferFunction.newInstance();
      // For demonstration, create a simple grayscale ramp from min to max scalar values
      const dataArray = dataset.getPointData().getScalars();
      const range = dataArray.getRange();
      ctf.addRGBPoint(range[0], 0, 0, 0);
      ctf.addRGBPoint(range[1], 1, 1, 1);

      // Create and configure the opacity transfer function (piecewise function)
      const ofun = vtkPiecewiseFunction.newInstance();
      ofun.addPoint(range[0], 0.0);
      ofun.addPoint(range[1], 1.0);

      // Apply the CTF and opacity function to the volume property
      volumeActor.getProperty().setRGBTransferFunction(0, ctf);
      volumeActor.getProperty().setScalarOpacity(0, ofun);
      volumeActor.getProperty().setInterpolationTypeToLinear();

      // Position the camera to focus on the dataset bounds
      const bounds = dataset.getBounds();
      const center = [
        (bounds[0] + bounds[1]) / 2,
        (bounds[2] + bounds[3]) / 2,
        (bounds[4] + bounds[5]) / 2,
      ];

      const camera = vtkCamera.newInstance();
      const distance = Math.max(
        bounds[1] - bounds[0],
        bounds[3] - bounds[2],
        bounds[5] - bounds[4]
      ) * 1.5; // Adjust camera distance based on dataset size

      camera.setPosition(center[0], center[1], center[2] + distance);
      camera.setFocalPoint(center[0], center[1], center[2]);
      camera.setViewUp(0, 1, 0);

      renderer.setActiveCamera(camera);

      // Reset the camera and render the scene
      renderer.resetCamera();
      renderWindow.render();
    });

    // Handle window resize
    window.addEventListener('resize', () => fullScreenRenderer.setSize());
  </script>
</body>
</html>


---

### ðŸ’¡ **Code Explanation and Logic Walkthrough**

#### âœ… 1. **Loading Remote Data**
- The `vtkHttpDataSetReader` is used to fetch the `.vtp` dataset from the provided URL (`http://127.0.0.1:5000/dataset/airfoil_oneslice.vtp`).
- Once the data is fetched and parsed, we call `reader.update()` and get the output dataset using `reader.getOutputData(0)`.

#### âœ… 2. **Activating Scalar Array ("p")**
- We activate the scalar array named `"p"` using:
  js
  dataset.getPointData().setActiveScalars('p');
  
- This ensures that the volume rendering uses the pressure field (`p`) for color encoding.

#### âœ… 3. **Volume Rendering Setup**
- A `vtkVolumeMapper` and `vtkVolume` are created.
- The dataset is passed into the mapper, and the volume actor is linked to it.
- Color and opacity functions are set up:
  - `vtkColorTransferFunction` maps scalar values to RGB colors.
  - `vtkPiecewiseFunction` defines how scalar values translate to opacity (alpha).

#### âœ… 4. **Camera Configuration**
- The dataset bounds are obtained via `dataset.getBounds()`.
- Camera position is calculated to look at the center of the dataset from an appropriate distance.
- `camera.setPosition`, `camera.setFocalPoint`, and `camera.setViewUp` define the view direction and orientation.
- Finally, `renderer.resetCamera()` ensures everything fits within the view.

#### âœ… 5. **Responsive Rendering**
- The render window adjusts dynamically to browser resizing by listening to the `resize` event.

---

### ðŸ§ª Notes for Use:
- Ensure the server hosting the `.vtp` file supports CORS headers if accessed across domains.
- Verify that the scalar array name `"p"` matches exactly what's present in the dataset.
- You can enhance the visualization further by customizing the color and opacity transfer functions based on scalar ranges or domain-specific knowledge.

This implementation meets all user requirements: remote dataset loading, volume rendering using `p` scalar, proper camera setup, and clean use of specified APIs like `vtkHttpDataSetReader`, `vtkVolumeMapper`, `vtkVolume`, etc.