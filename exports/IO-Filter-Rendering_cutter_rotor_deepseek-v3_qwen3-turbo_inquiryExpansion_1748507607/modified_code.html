<!DOCTYPE html>
<html>

<head>
    <title>VTK.js Rotor Slice Visualization</title>
    <script src="https://unpkg.com/vtk.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <script>
        // Load the vtk.js library
        const vtk = window.vtk;
        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;

        // Create a container for the visualization
        const container = document.getElementById('container');

        // Create a renderer, render window, and interactor
        // const renderer = vtk.Rendering.Core.vtkRenderer.newInstance();

        // const renderWindow = vtk.Rendering.Core.vtkRenderWindow.newInstance();
        // renderWindow.addRenderer(renderer);

         // 创建渲染窗口
         const fullScreenRenderWindow = vtkFullScreenRenderWindow.newInstance({
            rootContainer: document.getElementById('container'),
            background: [0.1, 0.1, 0.1]
        });

        const renderWindow = fullScreenRenderWindow.getRenderWindow();
        const renderer = fullScreenRenderWindow.getRenderer();

        // const interactor = vtk.Rendering.Core.vtkRenderWindowInteractor.newInstance();
        // interactor.setView(renderWindow.getViews()[0]);
        // interactor.initialize();
        // interactor.bindEvents(container);

        // Create a reader to load the dataset
        const reader = vtk.IO.XML.vtkXMLImageDataReader.newInstance();
        reader.setUrl('http://127.0.0.1:5000/dataset/rotor_simplified.vti').then(() => {
            // Set "Pressure" as the active scalar
            const dataset = reader.getOutputData(0);

            // const dataset = reader.getOutputData();
            dataset.getPointData().setActiveScalars('Pressure');

            // Create a slice filter
            // const slice = vtk.Filters.General.vtkImageSlice.newInstance();
            const sliceMapper =  vtk.Rendering.Core.vtkImageMapper.newInstance();
            const slice = vtk.Rendering.Core.vtkImageSlice.newInstance();
            sliceMapper.setInputData(dataset);
            // slice.setInputData(dataset);
            // slice.setSlicingMode(vtk.Rendering.Core.vtkImageSlice.SlicingMode.Y_AXIS);

            sliceMapper.setSlicingMode(vtk.Rendering.Core.vtkImageMapper.SlicingMode.Y_AXIS);
            sliceMapper.setSlice(Math.floor(dataset.getDimensions()[1] * 0.8)); // 80% depth along Y-axis
            slice.setMapper(sliceMapper);

            // Create a mapper and actor for the slice
            // const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
            // mapper.setInputConnection(slice.getOutputPort());

            // Create a color transfer function for pressure values (blue→white→red gradient)
            const ctfun = vtk.Rendering.Core.vtkColorTransferFunction.newInstance();
            ctfun.addRGBPoint(-100, 0, 0, 1); // Blue for low pressure
            ctfun.addRGBPoint(0, 1, 1, 1);   // White for mid pressure
            ctfun.addRGBPoint(100, 1, 0, 0); // Red for high pressure


            // Set the color transfer function and full opacity
            // const actor = vtk.Rendering.Core.vtkActor.newInstance();
            slice.getProperty().setRGBTransferFunction(0, ctfun);
            // slice.getProperty().setOpacity(1.0); // Full opacity
            // slice.getProperty().setScalarOpacity(0, opacityFunction);
            slice.getProperty().setUseLookupTableScalarRange(true);

            // // Add the actor to the renderer
            // renderer.addActor(slice);

            // // Add an orientation marker (XYZ axes) for spatial reference
            // const axes = vtk.Rendering.Core.vtkAxesActor.newInstance();
            // renderer.addActor(axes);

            // Reset the camera and render the scene
            renderer.resetCamera();
            renderWindow.render();
        });

    
    </script>
</body>

</html>

