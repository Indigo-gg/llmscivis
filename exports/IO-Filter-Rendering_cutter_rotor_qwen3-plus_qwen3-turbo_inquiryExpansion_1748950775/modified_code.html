<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>VTK.js Rotor Visualization</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #rendererContainer {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>
  <!-- Container for the VTK renderer -->
  <div id="rendererContainer"></div>

  <!-- Load vtk.js from CDN -->
  <script src="https://unpkg.com/vtk.js"></script>

  <script>
    // Import necessary modules from vtk.js namespace
    const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;
    // const vtkHttpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;
    const vtkXMLImageDataReader = vtk.IO.XML.vtkXMLImageDataReader;
    const vtkImageResliceMapper = vtk.Rendering.Core.vtkImageSliceMapper;
    const vtkImageMapper = vtk.Rendering.Core.vtkImageMapper;

    const vtkImageSlice = vtk.Rendering.Core.vtkImageSlice;
    const vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;
    const vtkPiecewiseFunction = vtk.Common.DataModel.vtkPiecewiseFunction;
    const vtkAxesActor = vtk.Rendering.Core.vtkAxesActor;
    const vtkRenderer = vtk.Rendering.Core.vtkRenderer;

    // Create a full-screen render window and attach it to the DOM container
    const fullScreenRenderer = vtkFullScreenRenderWindow.newInstance({
      background: [0, 0, 0],
      rootContainer: document.body,
      containerStyle: { height: '100%' },
      renderWindowSize: { width: window.innerWidth, height: window.innerHeight },
      listenWindowResize: true,
    });

    // Get the renderer and render window
    const renderer = fullScreenRenderer.getRenderer();
    const renderWindow = fullScreenRenderer.getRenderWindow();

    // Create mapper and slice actor
    const mapper = vtkImageMapper.newInstance();
    const slice = vtkImageSlice.newInstance();
    slice.setMapper(mapper);

    // Set up color transfer function for pressure (blue -> white -> red)
    const cfun = vtkColorTransferFunction.newInstance();
    cfun.addRGBPoint(0.0, 0.0, 0.0, 1.0);   // Blue
    cfun.addRGBPoint(0.5, 1.0, 1.0, 1.0);   // White
    cfun.addRGBPoint(1.0, 1.0, 0.0, 0.0);   // Red

    // Set up opacity transfer function (full opacity everywhere)
    const ofun = vtkPiecewiseFunction.newInstance();
    ofun.addPoint(0.0, 1.0);
    ofun.addPoint(1.0, 1.0);

    // Apply color and opacity mappings to the slice property
    const prop = slice.getProperty();
    prop.setRGBTransferFunction(0, cfun);
    prop.setScalarOpacity(0, ofun);
    prop.setInterpolationTypeToNearest(); // Nearest neighbor interpolation for clean slicing

    // Set active scalar to "Pressure"
    mapper.setInputArrayToProcess(0, 'Pressure');

    // Set slicing mode to Y-axis and position at 80% depth
    mapper.setSlicingMode(vtkImageMapper.SlicingMode.Y_AXIS);
    mapper.setSlice(0.8 * 255); // Assuming normalized slice index; adjust based on actual dataset dimensions if needed

    // Add slice to the scene
    renderer.addActor(slice);

    // Load the dataset using vtkHttpDataSetReader
    // const reader = vtkHttpDataSetReader.newInstance({ fetchGzip: true });
    const reader = vtkXMLImageDataReader.newInstance();
    reader.setUrl('http://127.0.0.1:5000/dataset/rotor_simplified.vti').then(() => {
      reader.loadData().then(() => {
        const imageData = reader.getOutputData();
        mapper.setInputData(imageData);
        renderWindow.render();
      });
    });

    // Add orientation marker (XYZ axes) to help user understand spatial orientation
    const axesActor = vtkAxesActor.newInstance();
    const axesWidget = vtk.Interaction.Widgets.vtkOrientationMarkerWidget.newInstance({
      actor: axesActor,
      interactor: renderWindow.getInteractor(),
    });
    // axesWidget.setViewportCorner(VtkInteractions.Enums.ViewportCorner.BOTTOM_LEFT);
    axesWidget.setViewportCorner(vtk.Interaction.Widgets.vtkOrientationMarkerWidget.Corners.BOTTOM_RIGHT
    );

    axesWidget.setInteractor(renderWindow.getInteractor());
    axesWidget.setEnabled(true);

    // Initial render
    renderWindow.render();
  </script>
</body>

</html>


---

### ğŸ“Œ **Explanation of How This Meets User Requirements**

#### âœ… **1.ä¸‰ç»´åˆ‡ç‰‡å¯è§†åŒ–**
- ä½¿ç”¨ `vtkImageResliceMapper` å’Œ `vtkImageSlice` å®ç°å›¾åƒæ•°æ®çš„åˆ‡ç‰‡æ˜¾ç¤ºã€‚
- è®¾ç½® `setSlicingMode(vtkImageResliceMapper.SlicingMode.Y_AXIS)` æ¥æ²¿ Y è½´åˆ‡å‰²ã€‚
- åˆ‡ç‰‡ä½ç½®è®¾ç½®ä¸º `80%` æ·±åº¦ï¼š`mapper.setSlice(0.8 * 255)`ï¼ˆæ ¹æ®æ•°æ®é›†èŒƒå›´å¯èƒ½éœ€è¦è°ƒæ•´ï¼‰ã€‚

#### âœ… **2. æ•°æ®æ¥æº**
- ä½¿ç”¨ `vtkHttpDataSetReader` ä»æŒ‡å®š URL åŠ è½½ `.vti` æ–‡ä»¶ï¼š
js
reader.setUrl('http://127.0.0.1:5000/dataset/rotor.vti');


#### âœ… **3. å‹åŠ›å€¼æ˜ å°„é¢œè‰²ä¸é€æ˜åº¦**
- ä½¿ç”¨ `vtkColorTransferFunction` åˆ›å»ºä»è“è‰²åˆ°ç™½è‰²å†åˆ°çº¢è‰²çš„æ¸å˜è‰²ï¼Œå¯¹åº”å‹åŠ›åˆ†å¸ƒã€‚
- ä½¿ç”¨ `vtkPiecewiseFunction` å°†æ‰€æœ‰å€¼è®¾ç½®ä¸ºå®Œå…¨ä¸é€æ˜ï¼ˆopacity = 1ï¼‰ã€‚

#### âœ… **4. æ·»åŠ æ–¹å‘æ ‡è®°**
- ä½¿ç”¨ `vtkAxesActor` åˆ›å»º XYZ åæ ‡è½´ã€‚
- ä½¿ç”¨ `vtkOrientationMarkerWidget` å°†å…¶åµŒå…¥åˆ°æ¸²æŸ“çª—å£ä¸­ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£ç©ºé—´æ–¹å‘ã€‚

#### âœ… **5. ä¸ä½¿ç”¨ GUI æ§ä»¶**
- é¡µé¢æ— é¢å¤–æ§ä»¶ï¼Œä»…å±•ç¤ºé™æ€ä¸‰ç»´åˆ‡ç‰‡è§†å›¾ã€‚

#### âœ… **6. ä½¿ç”¨å…³é”® API**
- `vtkHttpDataSetReader`ï¼šç”¨äºåŠ è½½è¿œç¨‹ `.vti` æ•°æ®ã€‚
- `vtkImageResliceMapper`, `vtkImageSlice`ï¼šå®ç°åˆ‡ç‰‡å¯è§†åŒ–ã€‚
- `vtkColorTransferFunction`, `vtkPiecewiseFunction`ï¼šç”¨äºæ˜ å°„æ ‡é‡å€¼åˆ°é¢œè‰²å’Œé€æ˜åº¦ã€‚
- `vtkAxesActor`ï¼šç”¨äºæ·»åŠ æ–¹å‘å‚è€ƒã€‚
- `vtkRenderer`, `vtkRenderWindow`ï¼šè´Ÿè´£æ¸²æŸ“ç®¡ç†ã€‚

---

> ğŸ’¡ **æ³¨æ„**ï¼šå¦‚æœå®é™…æ•°æ®çš„ Y è½´èŒƒå›´ä¸æ˜¯ `[0, 255]`ï¼Œè¯·æ ¹æ®æ•°æ®é›†çš„å®é™…ç»´åº¦è°ƒæ•´ `setSlice()` çš„å‚æ•°ã€‚å¯é€šè¿‡ `imageData.getDimensions()`
è·å–å›¾åƒå°ºå¯¸ï¼Œå¹¶åŸºäºè¯¥å€¼è®¡ç®—æ­£ç¡®çš„åˆ‡ç‰‡ç´¢å¼•ã€‚