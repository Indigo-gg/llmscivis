{
  "path": "",
  "name": "",
  "prompt": "Generate an HTML page using vtk.js to visualize the Redsea dataset with volume rendering.\n\nLoad the dataset from: http://127.0.0.1:5000/dataset/redsea.vti\n\nCompute velocity magnitude from the \"velocity\" array and set it as the active scalar\n\nApply volume rendering using a blue → white → red color map spanning the scalar range (min to max)\n\nApply a piecewise opacity function to control transparency across scalar values\n\nSet shading, ambient, diffuse, and specular properties for realistic volume appearance\n\nAdjust the camera to look along +Z and center on the dataset",
  "ground_truth": "<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>redsea Example</title>\n<script src=\"https://unpkg.com/vtk.js\"></script>\n</head>\n\n<body>\n<div id=\"renderer\"></div>\n<!-- <script src=\"https://unpkg.com/vtk.js\"></script> -->\n<script>\nconst vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\nconst vtkVolume = vtk.Rendering.Core.vtkVolume;\nconst vtkVolumeMapper = vtk.Rendering.Core.vtkVolumeMapper;\n\nconst vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;\nconst vtkPiecewiseFunction = vtk.Common.DataModel.vtkPiecewiseFunction;\nconst vtkXMLImageDataReader = vtk.IO.XML.vtkXMLImageDataReader;\n\n//init the render window\nconst fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\nbackground: [1,1,1],\n});\nconst renderWindow = fullScreenRenderWindow.getRenderWindow();\nconst renderer = fullScreenRenderWindow.getRenderer();\n\n\n// Load dataset\nconst reader = vtkXMLImageDataReader.newInstance();\n\n\n// set url and load the data\nreader.setUrl('http://127.0.0.1:5000/dataset/redsea.vti').then(() => {\nreader.loadData().then(() => {\n//prepare dataset\nconst imageData = reader.getOutputData(0);\n//set active scalar\nconst velocityArray = imageData.getPointData().getArrayByName('velocity');\nconst numPoints = imageData.getNumberOfPoints();\nconst magnitudeData = new Float64Array(numPoints);\nfor (let i = 0; i < numPoints; i++) {\nconst vx = velocityArray.getData()[3 * i + 0];\nconst vy = velocityArray.getData()[3 * i + 1];\nconst vz = velocityArray.getData()[3 * i + 2];\nmagnitudeData[i] = Math.sqrt(vx * vx + vy * vy + vz * vz);\n}\n\nconst vtkDataArray = vtk.Common.Core.vtkDataArray;\nconst magnitudeVtkArray = vtkDataArray.newInstance({\nnumberOfComponents: 1,\nvalues: magnitudeData,\nname: 'velocityMagnitude',\n});\nimageData.getPointData().addArray(magnitudeVtkArray);\nconsole.log(imageData.toJSON())\n\n\nimageData.getPointData().setActiveScalars('velocityMagnitude');\nimageData.setSpacing(0.05, 0.05, 0.1);\n\nconsole.log('New bounds:', imageData.getBounds());\nconsole.log('Dimensions:', imageData.getDimensions());\nconsole.log('Spacing:', imageData.getSpacing());\n\nconst newRange = magnitudeVtkArray.getRange();\nconsole.log('velocityMagnitude range:', newRange);\nconst [minV, maxV] = newRange;\n\n\nconsole.log(imageData.getPointData().getScalars().getName());\n\n\n//create the mapper and set its property\nconst mapper = vtkVolumeMapper.newInstance();\n//console.log(data.toJSON())\nmapper.setMaximumSamplesPerRay(4000); // or even higher, up to your hardware limits\nmapper.setInputData(imageData);\nmapper.setSampleDistance(0.1);\n\n//create actor and set its properties, including gradient opacity, scalar opacity, shade, ambient, diffuse, specular etc.\nconst actor = vtkVolume.newInstance();\n\n// Move LocalAmbientOcclusion properties to actor's property\nactor.getProperty().setLocalAmbientOcclusion(0);\nactor.getProperty().setLAOKernelSize(10);\nactor.getProperty().setLAOKernelRadius(5);\n// Move ComputeNormalFromOpacity to actor's property\nactor.getProperty().setComputeNormalFromOpacity(true);\n\nconst cfun = vtkColorTransferFunction.newInstance();\ncfun.addRGBPoint(minV, 0.0, 0.0, 1.0);\ncfun.addRGBPoint((minV + maxV) * 0.5, 1.0, 1.0, 1.0);\ncfun.addRGBPoint(maxV, 1.0, 0.0, 0.0);\nactor.getProperty().setRGBTransferFunction(0, cfun);\n\nconst ofun = vtkPiecewiseFunction.newInstance();\n\nofun.addPoint(minV, 0.0);\nofun.addPoint(minV + 0.1 * (maxV - minV), 0.05);\nofun.addPoint(minV + 0.5 * (maxV - minV), 0.2);\nofun.addPoint(maxV, 1.0);\n\nactor.getProperty().setScalarOpacity(0, ofun);\nactor.getProperty().setInterpolationTypeToLinear();\n// this variable makes results lighter\nactor.getProperty().setScalarOpacityUnitDistance(0, 0.1);\nactor.getProperty().setShade(false);\nactor.getProperty().setAmbient(0.3);\nactor.getProperty().setDiffuse(1);\nactor.getProperty().setSpecular(1);\n\n//assign mapper to actor and assign mapper to render\nactor.setMapper(mapper);\nrenderer.addVolume(actor);\n\nconst bounds = imageData.getBounds();\nconst center = [\n(bounds[0] + bounds[1]) / 2,\n(bounds[2] + bounds[3]) / 2,\n(bounds[4] + bounds[5]) / 2,\n];\n\nconst camera = renderer.getActiveCamera();\ncamera.setFocalPoint(...center);\ncamera.setPosition(center[0], center[1], center[2] + 10); // Look along +Z\ncamera.setViewUp(0, 1, 0);\nrenderer.resetCameraClippingRange();\nrenderWindow.render();\nrenderer.resetCamera();\nrenderWindow.render();\n});\n});\n\n</script>\n</body>\n\n</html>",
  "generated_code": "```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Redsea Volume Rendering</title>\n    <script src=\"https://unpkg.com/vtk.js@34.10.0/vtk.js\"></script>\n</head>\n<body>\n    <script>\n        // Import required VTK modules\n        const fullScreenRenderer = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0]\n        });\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n\n        // Create reader for VTI data\n        const reader = vtk.IO.Core.vtkHttpDataSetReader.newInstance({ fetchGzip: true });\n        reader.setUrl('http://127.0.0.1:5000/dataset/redsea.vti', { loadData: true })\n            .then(() => {\n                const dataset = reader.getOutputData();\n\n                // Compute velocity magnitude from velocity array\n                const velocityArray = dataset.getPointData().getArray('velocity');\n                const velocityMagnitude = new Float32Array(velocityArray.getNumberOfTuples());\n                \n                for (let i = 0; i < velocityArray.getNumberOfTuples(); i++) {\n                    const v = velocityArray.getTuple(i);\n                    velocityMagnitude[i] = Math.sqrt(v[0]*v[0] + v[1]*v[1] + v[2]*v[2]);\n                }\n\n                // Create new array for velocity magnitude and set as active scalar\n                const magnitudeArray = vtk.Common.Core.vtkDataArray.newInstance({\n                    name: 'velocityMagnitude',\n                    values: velocityMagnitude,\n                    numberOfComponents: 1\n                });\n                dataset.getPointData().addArray(magnitudeArray);\n                dataset.getPointData().setActiveScalars('velocityMagnitude');\n\n                // Get scalar range for color/opacity mapping\n                const scalarRange = magnitudeArray.getRange();\n\n                // Create color transfer function (blue-white-red)\n                const colorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction.newInstance();\n                colorTransferFunction.addRGBPoint(scalarRange[0], 0, 0, 1); // Blue at min\n                colorTransferFunction.addRGBPoint(\n                    (scalarRange[0] + scalarRange[1]) / 2, \n                    1, 1, 1); // White at middle\n                colorTransferFunction.addRGBPoint(scalarRange[1], 1, 0, 0); // Red at max\n\n                // Create piecewise opacity function\n                const opacityFunction = vtk.Common.DataModel.vtkPiecewiseFunction.newInstance();\n                opacityFunction.addPoint(scalarRange[0], 0.0);\n                opacityFunction.addPoint((scalarRange[0] + scalarRange[1]) * 0.2, 0.05);\n                opacityFunction.addPoint((scalarRange[0] + scalarRange[1]) * 0.7, 0.2);\n                opacityFunction.addPoint(scalarRange[1], 0.5);\n\n                // Create volume mapper\n                const mapper = vtk.Rendering.Core.vtkVolumeMapper.newInstance();\n                mapper.setInputData(dataset);\n                mapper.setSampleDistance(0.7);\n\n                // Create volume actor and set properties\n                const actor = vtk.Rendering.Core.vtkVolume.newInstance();\n                actor.setMapper(mapper);\n                \n                const property = actor.getProperty();\n                property.setRGBTransferFunction(0, colorTransferFunction);\n                property.setScalarOpacity(0, opacityFunction);\n                property.setInterpolationTypeToLinear();\n                property.setShade(true);\n                property.setAmbient(0.3);\n                property.setDiffuse(0.7);\n                property.setSpecular(0.4);\n                property.setSpecularPower(20);\n\n                // Add actor to renderer\n                renderer.addVolume(actor);\n\n                // Adjust camera to look along +Z and center on dataset\n                const center = dataset.getCenter();\n                renderer.resetCamera();\n                const camera = renderer.getActiveCamera();\n                camera.setPosition(\n                    center[0], \n                    center[1], \n                    center[2] + 2*Math.max(...dataset.getBounds().slice(1))\n                );\n                camera.setFocalPoint(center[0], center[1], center[2]);\n                camera.setViewUp(0, 1, 0);\n\n                renderWindow.render();\n            });\n    </script>\n</body>\n</html>\n```",
  "generator_prompt": "You are a VTK.js visualization expert. Based on the user's requirements and the provided VTK.js examples, generate complete and functional HTML code that meets all specified requirements.\n    Please follow these guidelines:\n    1. Generate complete HTML code that can run independently\n    2. Use the VTK.js library from CDN (https://unpkg.com/vtk.js@34.10.0/vtk.js)\n    3. Implement ALL requirements specified in the user question\n    4. Add detailed comments explaining how each requirement is implemented\n    5. Ensure the visualization is displayed properly without UI controls unless specifically requested\n    6. Use appropriate VTK.js modules and methods as shown in the examples\n    7. Pay special attention to data loading paths and visualization parameters\n    8. The data format for generating code is vti format, please use the correct IO module (e.g., vtkXMLImageDataReader)\n    Important: Highlight in comments how each specific user requirement is addressed in the code.\n",
  "final_prompt": "\nGenerate only the HTML code without any additional text.\nUser Requirements:\nGenerate an HTML page using vtk.js to visualize the Redsea dataset with volume rendering.\n\nLoad the dataset from: http://127.0.0.1:5000/dataset/redsea.vti\n\nCompute velocity magnitude from the \"velocity\" array and set it as the active scalar\n\nApply volume rendering using a blue → white → red color map spanning the scalar range (min to max)\n\nApply a piecewise opacity function to control transparency across scalar values\n\nSet shading, ambient, diffuse, and specular properties for realistic volume appearance\n\nAdjust the camera to look along +Z and center on the dataset\n\nRelevant VTK.js Examples:\n\n--------------------------------------------------------------------------------Example 1 (Score: 10.00, Matches: vtkVolumeMapper, vtkVolumeActor):\nDescription: Renders a 3D medical volume (`headsq.vti`) with a clipping plane, using `vtkVolumeMapper` and `vtkVolumeActor` for customized appearance.\n\nModules: vtk.Common.DataModel.vtkPiecewiseFunction, vtk.Common.DataModel.vtkPlane, vtk.IO.Core.vtkHttpDataSetReader.newInstance, vtk.Rendering.Core.vtkVolume, vtk.Rendering.Core.vtkVolumeMapper, vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n</head>\n\n<body>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        //using volume actor and mapper for rendering\n        const vtkVolumeActor = vtk.Rendering.Core.vtkVolume;\n        const vtkVolumeMapper = vtk.Rendering.Core.vtkVolumeMapper;\n        const vtkPiecewiseFunction = vtk.Common.DataModel.vtkPiecewiseFunction;\n        const vtkPlane = vtk.Common.DataModel.vtkPlane;\n\n        //init the render window\n        const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderWindow = fullScreenRenderWindow.getRenderWindow();\n        const renderer = fullScreenRenderWindow.getRenderer();\n\n        //create clip plan\n        const clipPlane = vtkPlane.newInstance();\n        const clipPlaneNormal = [0, 0, 1]\n\n        //set the data path and the reader\n        const dataPath = 'http://kitware.github.io/vtk-js/data/volume/headsq.vti';\n        const reader = vtk.IO.Core.vtkHttpDataSetReader.newInstance({ fetchGzip: true });\n\n        //load data from dataPath and render the results by actor and mapper\n        reader.setUrl(dataPath, { loadData: true })\n            .then(() => {\n                const data = reader.getOutputData(0);\n                \n                //compute the range of the data set and set clip plan accordingly\n                const extent = data.getExtent();\n                const spacing = data.getSpacing();\n                const sizeX = extent[1] * spacing[0];\n                const sizeY = extent[3] * spacing[1];\n\n                clipPlanePosition = sizeX / 2;\n\n                const clipPlaneOrigin = [\n                    clipPlanePosition * clipPlaneNormal[0],\n                    clipPlanePosition * clipPlaneNormal[1],\n                    clipPlanePosition * clipPlaneNormal[2],\n                ];\n\n                clipPlane.setNormal(clipPlaneNormal);\n                clipPlane.setOrigin(clipPlaneOrigin);\n\n                //create the mapper and set its property\n                const mapper = vtkVolumeMapper.newInstance();\n                mapper.addClippingPlane(clipPlane);\n                mapper.setInputData(data);\n                mapper.setSampleDistance(1);\n                mapper.setVolumetricScatteringBlending(0);\n                mapper.setLocalAmbientOcclusion(0);\n                mapper.setLAOKernelSize(10);\n                mapper.setLAOKernelRadius(5);\n                mapper.setComputeNormalFromOpacity(true);\n\n                //create actor and set its properties, including gradient opacity, scalar opacity, shade, ambient, diffuse, specular etc.\n                const actor = vtkVolumeActor.newInstance();\n                const ofun = vtkPiecewiseFunction.newInstance();\n                ofun.addPoint(0.0, 0.1);\n                ofun.addPoint(255.0, 1.0);\n                actor.getProperty().setScalarOpacity(0, ofun);\n                actor.getProperty().setInterpolationTypeToLinear();\n                actor.getProperty().setUseGradientOpacity(0, true);\n                actor.getProperty().setGradientOpacityMinimumValue(0, 2);\n                actor.getProperty().setGradientOpacityMinimumOpacity(0, 0.0);\n                actor.getProperty().setGradientOpacityMaximumValue(0, 20);\n                actor.getProperty().setGradientOpacityMaximumOpacity(0, 1.0);\n                actor.getProperty().setScalarOpacityUnitDistance(0, 2.955);\n                actor.getProperty().setShade(true);\n                actor.getProperty().setAmbient(0.3);\n                actor.getProperty().setDiffuse(1);\n                actor.getProperty().setSpecular(1);\n\n                //assign mapper to actor and assign mapper to render\n                actor.setMapper(mapper);\n                renderer.addVolume(actor);\n                renderer.resetCamera();\n                renderWindow.render();\n            });\n    </script>\n</body>\n\n</html>\n\nExample 2 (Score: 10.00, Matches: vtkVolumeMapper, vtkVolumeActor):\nDescription: Loads a 3D volume dataset and renders it using `vtkVolumeActor` and `vtkVolumeMapper` with extensive customization for appearance and quality.\n\nModules: vtk.Common.DataModel.vtkPiecewiseFunction, vtk.IO.Core.vtkHttpDataSetReader.newInstance, vtk.Rendering.Core.vtkColorTransferFunction, vtk.Rendering.Core.vtkVolume, vtk.Rendering.Core.vtkVolumeMapper, vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n</head>\n\n<body>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        //using volume actor and mapper for rendering\n        const vtkVolumeActor = vtk.Rendering.Core.vtkVolume;\n        const vtkVolumeMapper = vtk.Rendering.Core.vtkVolumeMapper;\n        const vtkColorTransferFunction = vtk.Rendering.Core.vtkColorTransferFunction;\n        const vtkPiecewiseFunction = vtk.Common.DataModel.vtkPiecewiseFunction;\n\n        //init the render window\n        const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderWindow = fullScreenRenderWindow.getRenderWindow();\n        const renderer = fullScreenRenderWindow.getRenderer();\n\n        //set the data path and the reader\n        const dataPath = 'http://kitware.github.io/vtk-js/data/volume/headsq.vti';\n        const reader = vtk.IO.Core.vtkHttpDataSetReader.newInstance({ fetchGzip: true });\n\n        //load data from dataPath and render the results by actor and mapper\n        reader.setUrl(dataPath, { loadData: true })\n            .then(() => {\n                const data = reader.getOutputData(0);\n                //create the mapper and set its property\n                const mapper = vtkVolumeMapper.newInstance();\n                console.log(data.toJSON())\n                mapper.setInputData(data);\n                mapper.setSampleDistance(0.7);\n                mapper.setVolumetricScatteringBlending(0);\n                mapper.setLocalAmbientOcclusion(0);\n                mapper.setLAOKernelSize(10);\n                mapper.setLAOKernelRadius(5);\n                mapper.setComputeNormalFromOpacity(true);\n\n                //create actor and set its properties, including gradient opacity, scalar opacity, shade, ambient, diffuse, specular etc.\n                const actor = vtkVolumeActor.newInstance();\n                const ofun = vtkPiecewiseFunction.newInstance();\n                ofun.addPoint(0.0, 0.1);\n                ofun.addPoint(255.0, 1.0);\n                actor.getProperty().setScalarOpacity(0, ofun);\n                actor.getProperty().setInterpolationTypeToLinear();\n                actor.getProperty().setUseGradientOpacity(0, true);\n                actor.getProperty().setGradientOpacityMinimumValue(0, 2);\n                actor.getProperty().setGradientOpacityMinimumOpacity(0, 0.0);\n                actor.getProperty().setGradientOpacityMaximumValue(0, 20);\n                actor.getProperty().setGradientOpacityMaximumOpacity(0, 1.0);\n                actor.getProperty().setScalarOpacityUnitDistance(0, 2.955);\n                actor.getProperty().setShade(true);\n                actor.getProperty().setAmbient(0.3);\n                actor.getProperty().setDiffuse(1);\n                actor.getProperty().setSpecular(1);\n\n                //assign mapper to actor and assign mapper to render\n                actor.setMapper(mapper);\n                renderer.addVolume(actor);\n                renderer.resetCamera();\n                renderWindow.render();\n            });\n    </script>\n</body>\n\n</html>\n\nExample 3 (Score: 5.00, Matches: vtkHttpDataSetReader):\nDescription: Loads a 3D volume and displays three orthogonal image slices (I, J, K planes) at the 30th layer using `vtkHttpDataSetReader` and `vtkImageSlice`.\n\nModules: vtk.IO.Core.vtkHttpDataSetReader, vtk.Rendering.Core.vtkImageMapper, vtk.Rendering.Core.vtkImageSlice, vtk.Rendering.Misc.vtkFullScreenRenderWindow\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const vtkHttpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;\n        const vtkImageMapper = vtk.Rendering.Core.vtkImageMapper;\n        const vtkImageSlice = vtk.Rendering.Core.vtkImageSlice;\n        const dataPath = 'http://kitware.github.io/vtk-js/data/volume/headsq.vti';\n\n        const fullScreenRenderWindow = vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderWindow = fullScreenRenderWindow.getRenderWindow();\n        const renderer = fullScreenRenderWindow.getRenderer();\n\n        const imageActorI = vtkImageSlice.newInstance();\n        const imageActorJ = vtkImageSlice.newInstance();\n        const imageActorK = vtkImageSlice.newInstance();\n\n        renderer.addActor(imageActorK);\n        renderer.addActor(imageActorJ);\n        renderer.addActor(imageActorI);\n\n        const reader = vtkHttpDataSetReader.newInstance({\n            fetchGzip: true,\n        });\n        reader\n            .setUrl(dataPath, { loadData: true })\n            .then(() => {\n                const data = reader.getOutputData();\n                const dataRange = data.getPointData().getScalars().getRange();\n                const extent = data.getExtent();\n\n                const imageMapperK = vtkImageMapper.newInstance();\n                imageMapperK.setInputData(data);\n                imageMapperK.setKSlice(30);\n                imageActorK.setMapper(imageMapperK);\n\n                const imageMapperJ = vtkImageMapper.newInstance();\n                imageMapperJ.setInputData(data);\n                imageMapperJ.setJSlice(30);\n                imageActorJ.setMapper(imageMapperJ);\n\n                const imageMapperI = vtkImageMapper.newInstance();\n                imageMapperI.setInputData(data);\n                imageMapperI.setISlice(30);\n                imageActorI.setMapper(imageMapperI);\n\n                renderer.resetCamera();\n                renderWindow.render();\n            });\n    </script>\n</body>\n\n</html>\n\nExample 4 (Score: 5.00, Matches: vtkHttpDataSetReader):\nDescription: Loads and visualizes a 3D model (VTP format) from a remote URL using `vtkHttpDataSetReader` with gzip support.\n\nModules: vtk.IO.Core.DataAccessHelper.HttpDataAccessHelper, vtk.IO.Core.vtkHttpDataSetReader, vtk.Rendering.Core.vtkActor, vtk.Rendering.Core.vtkMapper, vtk.Rendering.Misc.vtkFullScreenRenderWindow, vtk.Rendering.OpenGL.Profiles.Geometry\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js IO-HttpDataSetReader</title>\n</head>\n\n<body>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const data_path = 'http://kitware.github.io/vtk-js/data/cow.vtp'\n        const vtkHttpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;\n        // const vtkGeometry = vtk.Rendering.OpenGL.Profiles.Geometry\n\n        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const vtkActor = vtk.Rendering.Core.vtkActor\n        const vtkMapper = vtk.Rendering.Core.vtkMapper\n\n        // Force the loading of HttpDataAccessHelper to support gzip decompression\n        const vtkHttpDataAccessHelper = vtk.IO.Core.DataAccessHelper.HttpDataAccessHelper\n\n        // ----------------------------------------------------------------------------\n        // Standard rendering code setup\n        // ----------------------------------------------------------------------------\n\n        const fullScreenRenderer = vtkFullScreenRenderWindow.newInstance();\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n\n        // ----------------------------------------------------------------------------\n        // Example code\n        // ----------------------------------------------------------------------------\n        // Server is not sending the .gz and with the compress header\n        // Need to fetch the true file name and uncompress it locally\n        // ----------------------------------------------------------------------------\n\n        const reader = vtkHttpDataSetReader.newInstance({ fetchGzip: true });\n        reader.setUrl(data_path).then(() => {\n            reader.loadData().then(() => {\n                renderer.resetCamera();\n                renderWindow.render();\n            });\n        });\n\n        const mapper = vtkMapper.newInstance();\n        mapper.setInputConnection(reader.getOutputPort());\n\n        const actor = vtkActor.newInstance();\n        actor.setMapper(mapper);\n\n        renderer.addActor(actor);\n\n        // -----------------------------------------------------------\n        // Make some variables global so that you can inspect and\n        // modify objects in your browser's developer console:\n        // -----------------------------------------------------------\n\n        // global.source = reader;\n        // global.mapper = mapper;\n        // global.actor = actor;\n        // global.renderer = renderer;\n        // global.renderWindow = renderWindow;\n\n    </script>\n</body>\n\n</html>\n\nExample 5 (Score: 5.00, Matches: vtkHttpDataSetReader):\nDescription: Loads 3D polydata, writes it to a string using `vtkXMLPolyDataWriter`, reads it back with `vtkXMLPolyDataReader`, and renders it, allowing download of the generated VTP file.\nModules: vtk.IO.Core.vtkHttpDataSetReader, vtk.IO.XML.vtkXMLPolyDataReader, vtk.IO.XML.vtkXMLPolyDataWriter, vtk.IO.XML.vtkXMLWriter, vtk.Rendering.Core.vtkActor.newInstance, vtk.Rendering.Core.vtkMapper.newInstance, vtk.Rendering.Misc.vtkFullScreenRenderWindow\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js XMLImagePolyDataWriter</title>\n    <!-- <link rel=\"stylesheet\" href=\"https://kit.fontawesome.com/419a5ebb56.css\" crossorigin=\"anonymous\"> -->\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n\n    <script type=\"text/javascript\" src=\"https://unpkg.com/@babel/polyfill@7.0.0/dist/polyfill.js\"></script>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <script>\n        const mapper = vtk.Rendering.Core.vtkMapper.newInstance();\n        const actor = vtk.Rendering.Core.vtkActor.newInstance();\n        const fullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const httpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;\n        const xmlPolyDataWriter = vtk.IO.XML.vtkXMLPolyDataWriter;\n        const xmlPolyDataReader = vtk.IO.XML.vtkXMLPolyDataReader;\n        const xmlWriter = vtk.IO.XML.vtkXMLWriter;\n        // Create instances using namespace paths\n        const fullScreenRenderer = fullScreenRenderWindow.newInstance();\n        const renderer = fullScreenRenderer.getRenderer();\n        const renderWindow = fullScreenRenderer.getRenderWindow();\n        const reader = httpDataSetReader.newInstance({ fetchGzip: true });\n\n        const writer = xmlPolyDataWriter.newInstance();\n        writer.setFormat(xmlWriter.FormatTypes.BINARY);\n        writer.setInputConnection(reader.getOutputPort());\n\n        const writerReader = xmlPolyDataReader.newInstance();\n\n        reader.setUrl(`http://kitware.github.io/vtk-js/data/cow.vtp`, { loadData: true }).then(() => {\n            const fileContents = writer.write(reader.getOutputData());\n\n            // Try to read it back.\n            const textEncoder = new TextEncoder();\n            writerReader.parseAsArrayBuffer(textEncoder.encode(fileContents));\n            renderer.resetCamera();\n            renderWindow.render();\n\n            const blob = new Blob([fileContents], { type: 'text/plain' });\n            const a = window.document.createElement('a');\n            a.href = window.URL.createObjectURL(blob, { type: 'text/plain' });\n            a.download = 'cow.vtp';\n            a.text = 'Download';\n            a.style.position = 'absolute';\n            a.style.left = '50%';\n            a.style.bottom = '10px';\n            document.body.appendChild(a);\n            a.style.background = 'white';\n            a.style.padding = '5px';\n        });\n\n        actor.setMapper(mapper);\n\n        mapper.setInputConnection(writerReader.getOutputPort());\n\n        renderer.addActor(actor);\n\n        window.writer = writer;\n        window.writerReader = writerReader;\n        window.mapper = mapper;\n        window.actor = actor;\n        window.renderer = renderer;\n        window.renderWindow = renderWindow;\n\n\n    </script>\n\n</body>\n\n</html>\n\nExample 6 (Score: 5.00, Matches: vtkHttpDataSetReader):\nDescription: Loads a 3D volume (`headsq.vti`) and displays three orthogonal slices (I, J, K) with interactive controls for position and color properties.\n\nModules: vtk.IO.Core.vtkHttpDataSetReader, vtk.Rendering.Core.vtkImageMapper, vtk.Rendering.Core.vtkImageSlice, vtk.Rendering.Misc.vtkFullScreenRenderWindow\nCode:\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>vtk.js Isosurface Visualization</title>\n    <link rel=\"stylesheet\" href=\"https://kit.fontawesome.com/419a5ebb56.css\" crossorigin=\"anonymous\">\n    <style>\n        #renderer {\n            width: 100%;\n            height: 600px;\n            background-color: #333;\n        }\n    </style>\n</head>\n\n<body>\n    <div id=\"renderer\"></div>\n    <script src=\"https://unpkg.com/vtk.js\"></script>\n    <!-- Set vtk.js favicon -->\n    <script type=\"module\" src=\"https://unpkg.com/vtk.js/favicon.js\"></script>\n\n    <!-- Load WebGL and WebGPU rendering modules -->\n    <script type=\"module\" src=\"https://unpkg.com/vtk.js/Sources/Rendering/Profiles/Volume.js\"></script>\n\n    <!-- Force DataAccessHelper to access various data sources -->\n    <script type=\"module\"\n        src=\"https://unpkg.com/vtk.js/Sources/IO/Core/DataAccessHelper/HtmlDataAccessHelper.js\"></script>\n    <script type=\"module\"\n        src=\"https://unpkg.com/vtk.js/Sources/IO/Core/DataAccessHelper/HttpDataAccessHelper.js\"></script>\n    <script type=\"module\"\n        src=\"https://unpkg.com/vtk.js/Sources/IO/Core/DataAccessHelper/JSZipDataAccessHelper.js\"></script>\n\n    <script>\n        const vtkFullScreenRenderWindow = vtk.Rendering.Misc.vtkFullScreenRenderWindow;\n        const vtkHttpDataSetReader = vtk.IO.Core.vtkHttpDataSetReader;\n        const vtkImageMapper = vtk.Rendering.Core.vtkImageMapper;\n        const vtkImageSlice = vtk.Rendering.Core.vtkImageSlice;\n        const path = 'http://kitware.github.io/vtk-js/data'\n\n        // Reference HTML template\n        const controlPanel = `<table>\n    <tr>\n        <td>Slice I</td>\n        <td>\n            <input class='sliceI' type=\"range\" min=\"0\" max=\"2.0\" step=\"1\" value=\"1\" />\n        </td>\n    </tr>\n    <tr>\n        <td>Slice J</td>\n        <td>\n            <input class='sliceJ' type=\"range\" min=\"0\" max=\"2.0\" step=\"1\" value=\"1\" />\n        </td>\n    </tr>\n    <tr>\n        <td>Slice K</td>\n        <td>\n            <input class='sliceK' type=\"range\" min=\"0\" max=\"100\" step=\"1\" value=\"1\" />\n        </td>\n    </tr>\n    <tr>\n        <td>Color level</td>\n        <td>\n            <input class='colorLevel' type=\"range\" min=\"-3926\" max=\"3926\" step=\"1\" value=\"1\" />\n        </td>\n    </tr>\n    <tr>\n        <td>ColorWindow</td>\n        <td>\n            <input class='colorWindow' type=\"range\" min=\"0\" max=\"3926\" step=\"1\" value=\"1\" />\n        </td>\n    </tr>\n</table>\n`;\n        const fullScreenRenderWindow = vtkFullScreenRenderWindow.newInstance({\n            background: [0, 0, 0],\n        });\n        const renderWindow = fullScreenRenderWindow.getRenderWindow();\n        const renderer = fullScreenRenderWindow.getRenderer();\n        fullScreenRenderWindow.addController(controlPanel);\n\n        const imageActorI = vtkImageSlice.newInstance();\n        const imageActorJ = vtkImageSlice.newInstance();\n        const imageActorK = vtkImageSlice.newInstance();\n\n        renderer.addActor(imageActorK);\n        renderer.addActor(imageActorJ);\n        renderer.addActor(imageActorI);\n\n        function updateColorLevel(e) {\n            const colorLevel = Number(\n                (e ? e.target : document.querySelector('.colorLevel')).value\n            );\n            imageActorI.getProperty().setColorLevel(colorLevel);\n            imageActorJ.getProperty().setColorLevel(colorLevel);\n            imageActorK.getProperty().setColorLevel(colorLevel);\n            renderWindow.render();\n        }\n\n        function updateColorWindow(e) {\n            const colorLevel = Number(\n                (e ? e.target : document.querySelector('.colorWindow')).value\n            );\n            imageActorI.getProperty().setColorWindow(colorLevel);\n            imageActorJ.getProperty().setColorWindow(colorLevel);\n            imageActorK.getProperty().setColorWindow(colorLevel);\n            renderWindow.render();\n        }\n\n        const reader = vtkHttpDataSetReader.newInstance({\n            fetchGzip: true,\n        });\n        reader\n            .setUrl(`${path}/data/volume/headsq.vti`, { loadData: true })\n            .then(() => {\n                const data = reader.getOutputData();\n                const dataRange = data.getPointData().getScalars().getRange();\n                const extent = data.getExtent();\n\n                const imageMapperK = vtkImageMapper.newInstance();\n                imageMapperK.setInputData(data);\n                imageMapperK.setKSlice(30);\n                imageActorK.setMapper(imageMapperK);\n\n                const imageMapperJ = vtkImageMapper.newInstance();\n                imageMapperJ.setInputData(data);\n                imageMapperJ.setJSlice(30);\n                imageActorJ.setMapper(imageMapperJ);\n\n                const imageMapperI = vtkImageMapper.newInstance();\n                imageMapperI.setInputData(data);\n                imageMapperI.setISlice(30);\n                imageActorI.setMapper(imageMapperI);\n\n                renderer.resetCamera();\n                renderer.resetCameraClippingRange();\n                renderWindow.render();\n\n                ['.sliceI', '.sliceJ', '.sliceK'].forEach((selector, idx) => {\n                    const el = document.querySelector(selector);\n                    el.setAttribute('min', extent[idx * 2 + 0]);\n                    el.setAttribute('max', extent[idx * 2 + 1]);\n                    el.setAttribute('value', 30);\n                });\n\n                ['.colorLevel', '.colorWindow'].forEach((selector) => {\n                    document.querySelector(selector).setAttribute('max', dataRange[1]);\n                    document.querySelector(selector).setAttribute('value', dataRange[1]);\n                });\n                document\n                    .querySelector('.colorLevel')\n                    .setAttribute('value', (dataRange[0] + dataRange[1]) / 2);\n                updateColorLevel();\n                updateColorWindow();\n            });\n\n        document.querySelector('.sliceI').addEventListener('input', (e) => {\n            imageActorI.getMapper().setISlice(Number(e.target.value));\n            renderWindow.render();\n        });\n\n        document.querySelector('.sliceJ').addEventListener('input', (e) => {\n            imageActorJ.getMapper().setJSlice(Number(e.target.value));\n            renderWindow.render();\n        });\n\n        document.querySelector('.sliceK').addEventListener('input', (e) => {\n            imageActorK.getMapper().setKSlice(Number(e.target.value));\n            renderWindow.render();\n        });\n\n        document\n            .querySelector('.colorLevel')\n            .addEventListener('input', updateColorLevel);\n        document\n            .querySelector('.colorWindow')\n            .addEventListener('input', updateColorWindow);\n\n        window.fullScreen = fullScreenRenderWindow;\n        window.imageActorI = imageActorI;\n        window.imageActorJ = imageActorJ;\n        window.imageActorK = imageActorK;\n\n    </script>\n</body>\n\n</html>\n\n",
  "evaluator_prompt": "# Role\n\nYou are an expert Evaluator for vtk.js and web-based scientific visualization. Your task is to compare the [GENERATED_CODE] against the [GROUND_TRUTH] and evaluate it based on specific dimensions.\n\n# Input Data\n\n## Ground Truth Code:\n\n[GROUND_TRUTH]\n\n## Generated Code:\n\n[GENERATED_CODE]\n\n# Evaluation Criteria & Rubric (0.0 to 1.0)\n\nPlease evaluate the generated code based on the following 3 dimensions. \n\n1. **Functionality & Completeness (Task Completion)**: \n   - Does the code implement the same visualization pipeline as the ground truth? (e.g., correct readers, mappers, filters).\n   - Are critical elements present (e.g., color transfer functions, full-screen rendering)?\n   - Score 1.0 if logic is identical; lower if steps are missing.\n\n2. **Visual Fidelity (Visual Quality)**:\n   - Based on the code logic, will the visual output look similar to the ground truth?\n   - Check camera parameters, background colors, and opacity transfer functions.\n   - Check if the correct data arrays (scalars/vectors) are selected for coloring.\n\n3. **Code Quality & Maintainability**:\n   - Is the code readable, well-structured, and using vtk.js best practices?\n   - Is the variable naming clear?\n\n# Response Format\n\nYou must output the evaluation in the following Strict XML format. Do not use Markdown block quotes.\n\n<Evaluation>\n    <Dimension name=\"Functionality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Dimension name=\"VisualQuality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Dimension name=\"CodeQuality\">\n        <Score>[SCORE_FLOAT]</Score>\n        <Reason>[BRIEF_REASONING]</Reason>\n    </Dimension>\n    <Summary>\n        <OverallScore>[AVERAGE_SCORE]</OverallScore>\n        <Critique>[ONE_SENTENCE_SUMMARY]</Critique>\n    </Summary>\n</Evaluation>",
  "generator": "deepseek-v3",
  "evaluator": "deepseek-v3",
  "score": null,
  "workflow": {
    "inquiryExpansion": true,
    "rag": true
  },
  "eval_id": "1765274302",
  "eval_user": "test",
  "export_time": null,
  "console_output": null,
  "eval_time": "2025-12-09 17:58:22",
  "evaluator_evaluation": {
    "score": "0.8",
    "evaluator_evaluation": "avaluating the generated code against the ground truth:\n\n```xml \n<Evaluation>\n    <Dimension name=\"Functionality\">\n        <Score>0.8</Score>\n        <Reason>Most functionality is preserved but some details differ: different data reader (vtkHttpDataSetReader vs vtkXMLImageDataReader), missing local ambient occlusion settings, and opacity transfer function values/points are slightly different.</Reason>\n    </Dimension>\n    <Dimension name=\"VisualQuality\">\n        <Score>0.75</Score>\n        <Reason>The core visual properties are implemented (color mapping, volume rendering) but styling differs in opacity (simpler curve and lower max opacity) and lighting (specular/ambient/diffuse balance changed). Background color is black rather than white.</Reason>\n    </Dimension>\n    <Dimension name=\"CodeQuality\">\n        <Score>0.9</Score>\n        <Reason>The code is well-structured and readable, with good variable naming and proper vtk.js usage. It's slightly more concise than the ground truth in places where it could be.</Reason>\n    </Dimension>\n    <Summary>\n        <OverallScore>0.82</OverallScore>\n        <Critique>The generated code captures the core functionality with good code quality, but has some visual and implementation differences from the reference.</Critique>\n    </Summary>\n</Evaluation>\n```",
    "parsed_evaluation": null
  },
  "options": null,
  "analysis": [
    {
      "phase": "Data Loading",
      "step_name": "Load Redsea Dataset",
      "vtk_modules": [
        "vtkXMLImageDataReader",
        "vtkHttpDataSetReader"
      ],
      "description": "Load the Redsea dataset from 'http://127.0.0.1:5000/dataset/redsea.vti' using vtkHttpDataSetReader to fetch the data over HTTP, then use vtkXMLImageDataReader to parse the VTI format."
    },
    {
      "phase": "Data Processing",
      "step_name": "Compute Velocity Magnitude",
      "vtk_modules": [
        "vtkCalculator"
      ],
      "description": "Use vtkCalculator to compute the magnitude of the 'velocity' vector array and set it as the active scalar for subsequent volume rendering."
    },
    {
      "phase": "Visualization Setup",
      "step_name": "Set Volume Rendering",
      "vtk_modules": [
        "vtkVolumeMapper",
        "vtkVolumeActor",
        "vtkColorTransferFunction",
        "vtkPiecewiseFunction"
      ],
      "description": "Create a vtkVolumeMapper with the processed data. Define a color transfer function that maps scalar values from min to max to a blue → white → red gradient. Create a piecewise opacity function to control transparency across scalar values. Combine these into a vtkVolumeActor."
    },
    {
      "phase": "UI Configuration",
      "step_name": "Configure Shading Properties",
      "vtk_modules": [
        "vtkVolumeProperty"
      ],
      "description": "Set shading properties on the volume property: enable shading, set ambient to 0.3, diffuse to 0.7, specular to 0.5, and specular power to 10 for realistic appearance."
    },
    {
      "phase": "Rendering & Interaction",
      "step_name": "Adjust Camera and Render",
      "vtk_modules": [
        "vtkRenderer",
        "vtkRenderWindow",
        "vtkRenderWindowInteractor"
      ],
      "description": "Initialize a renderer, add the volume actor to it, set the camera to look along +Z axis and center on the dataset bounds, then create a render window and interactor to display the scene interactively."
    }
  ],
  "retrieval_results": [
    {
      "id": 895986302,
      "title": "data\\vtkjs-examples\\prompt-sample\\Filter-VolumeClip\\code.html",
      "description": "Renders a 3D medical volume (`headsq.vti`) with a clipping plane, using `vtkVolumeMapper` and `vtkVolumeActor` for customized appearance.\n",
      "relevance": 10.0,
      "matched_keywords": [
        "vtkVolumeMapper",
        "vtkVolumeActor"
      ]
    },
    {
      "id": 431419998,
      "title": "data\\vtkjs-examples\\prompt-sample\\Rendering-VolumeMapper\\code.html",
      "description": "Loads a 3D volume dataset and renders it using `vtkVolumeActor` and `vtkVolumeMapper` with extensive customization for appearance and quality.\n",
      "relevance": 10.0,
      "matched_keywords": [
        "vtkVolumeMapper",
        "vtkVolumeActor"
      ]
    },
    {
      "id": 739470138,
      "title": "data\\vtkjs-examples\\prompt-sample\\Filter-MultiImageSlice\\code.html",
      "description": "Loads a 3D volume and displays three orthogonal image slices (I, J, K planes) at the 30th layer using `vtkHttpDataSetReader` and `vtkImageSlice`.\n",
      "relevance": 5.0,
      "matched_keywords": [
        "vtkHttpDataSetReader"
      ]
    },
    {
      "id": 1869164750,
      "title": "data\\vtkjs-examples\\prompt-sample\\IO-HttpdatasetReader\\code.html",
      "description": "Loads and visualizes a 3D model (VTP format) from a remote URL using `vtkHttpDataSetReader` with gzip support.\n",
      "relevance": 5.0,
      "matched_keywords": [
        "vtkHttpDataSetReader"
      ]
    },
    {
      "id": 144437569,
      "title": "data\\vtkjs-examples\\prompt-sample\\IO-XMLImagePolyDataWriter\\code.html",
      "description": "Loads 3D polydata, writes it to a string using `vtkXMLPolyDataWriter`, reads it back with `vtkXMLPolyDataReader`, and renders it, allowing download of the generated VTP file.",
      "relevance": 5.0,
      "matched_keywords": [
        "vtkHttpDataSetReader"
      ]
    },
    {
      "id": 1338339492,
      "title": "data\\vtkjs-examples\\prompt-sample\\Rendering-MultiSliceImageMapper\\code.html",
      "description": "Loads a 3D volume (`headsq.vti`) and displays three orthogonal slices (I, J, K) with interactive controls for position and color properties.\n",
      "relevance": 5.0,
      "matched_keywords": [
        "vtkHttpDataSetReader"
      ]
    }
  ]
}